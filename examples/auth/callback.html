<!DOCTYPE html>
<html lang="en">
<head>
	<title>Spark Sample Application - callback</title>
	<meta charset="utf-8">
</head>

<body>

<!-- spark sdk -->
<script type="text/javascript" charset="utf-8" src="../../sdk/src/config/Constants.js"></script>
<script type="text/javascript" charset="utf-8" src="../../sdk/src/utilities/Helpers.js"></script>
<script type="text/javascript" charset="utf-8" src="../../sdk/src/auth/Client.js"></script>
<script type="text/javascript" charset="utf-8" src="../../sdk/src/utilities/Request.js"></script>

<script>

	/**
	 * Get the code param in URL after returning from Spark Auth flow
	 */
	function extractRedirectionCode() {
		var getParams = ADSKSpark.Helpers.extractParamsFromURL();
		return getParams['code'] ? getParams['code'] : null;
	}

	//Init the Spark Client
	ADSKSpark.Client.initialize('L6bHueQ3ADRhkn8cWCi4njZrDM9ZZV0r',// Your app key
			'http://localhost:3000/guest_token',// The guest token endpoint that is implemented by your server (i.e. http://example.com/guest_token)
			'http://localhost:3000/access_token',// The access token endpoint that is implemented by your server (i.e. http://example.com/access_token)
			ADSKSpark.Constants.API_HOST_SANDBOX // api host - production or sandbox
	);


	var code = extractRedirectionCode();

	if (code) {
		ADSKSpark.Client.completeLogin(code).then(function (token) {
			if (token) {
				//You can redirect now to some page in your app or to homepage
				// or to reload the top window or any other action
				window.opener.location.reload(true);

				//close the login window
				window.close();
			} else {
				console.error('Problem with fetching token');
			}
		}, function (error) {
			console.error(error);
		});
	}
</script>
</body>
</html>
