<!DOCTYPE html>
<html lang="en">
<head>
	<title>Spark Sample Application</title>
	<meta charset="utf-8">

	<!-- fonts -->
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:300,600,400' rel='stylesheet' type='text/css'>

	<!-- Bootstrap core CSS -->
	<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">

	<!-- Common styles, also cloudfront-->
	<link href="../../assets/css/common.css" rel="stylesheet">

	<style>

		iframe {
			width: 100%;
			border: 0;
			height: 500px;
		}

		.left-wrapper{
			position: relative;
			height:320px;
			margin-top: 20px;
			border-right: 1px solid lightgray;
		}

		#welcome-wrapper{
			position: absolute;
			top:0;
			bottom:0;
			left:0;
			right:0;
			margin: auto;
			text-align: center;
			height:170px;
			padding-right: 40px;
		}
		#auth-iframe-wrapper{
			padding-left: 40px;
		}

	</style>

</head>

<body>
<div class="container">
	<div class="col-sm-6 left-wrapper">
		<div id="welcome-wrapper">
			<h2>Welcome to <br/>Spark Storage</h2>

			<p>To try the demo, you need to login with a test environment account.</p>
		</div>
	</div>
	<div class="col-sm-6" id="auth-iframe-wrapper">
		<iframe></iframe>
	</div>

</div>
<!-- /container -->

<script type="text/javascript" charset="utf-8" src="//code.jquery.com/jquery-2.1.3.min.js"></script>

<!-- your config file -->
<script type="text/javascript" charset="utf-8" src="../../assets/scripts/config.js"></script>

<!-- spark sdk -->
<script type="text/javascript" charset="utf-8" src="../../vendor/spark/spark-config.js"></script>
<script type="text/javascript" charset="utf-8" src="../../vendor/spark/utilities.js"></script>
<script type="text/javascript" charset="utf-8" src="../../vendor/spark/spark-auth.js"></script>

<!-- end spark sdk -->
<!--<script type="text/javascript" charset="utf-8" src="//spark-dev-portal-stg.s3.amazonaws.com/sdk/spark-sdk-latest.min.js"></script>
should be cloudfront!
-->


<script>

	/**
	 * This is called upon returning from the login service
	 */
	function callbackFromAuthService(code, callback) {

		spark.auth.getAccessToken(code, function (token) {

			//if successful - the token will reside in the localStorage of the browser
			console.info('token:', token);
			if (callback) {
				callback(token);
			}

		});
	}

	/**
	 * Get the current logged in user and shows his scrren name
	 */
	function getMyProfileAndAddtoDOM() {
		//get the current member
		spark.auth.getMyProfile(function (response) {

			console.info('profile:', response);
			var loggedInText = 'Hi <b>' + response.member.screen_name + '</b>';
			$('body').prepend(loggedInText);
			$('#auth-iframe-wrapper').remove();
		});
	}

	/**
	 * Log the user out
	 */
	function logout() {
		spark.auth.logout();
		location.reload();
	}


	/**
	 * Run when DOM is ready.
	 * The spark object already exists in this point
	 */
	jQuery(function ($) {

		//First let's see if we have a valid access token
		if (spark.auth.isAccessTokenValid()) {
			//getMyProfileAndAddtoDOM();
			location.href = '../drive/show-my-assets/';

		} else {//user needs to login

			//if we get back from the login service
			var code = spark.util.extractRedirectionCode();

			if (code) {
				callbackFromAuthService(code, function (token) {
					if (token) {
						//You can redirect now to some page in your app or to homepage
						// or to reload the top window or any other action
						parent.window.location.reload();


					} else {
						console.error('Problem with fetching token');
					}
				});
			} else {

				// Set up the iframe for the login screen
				//and it's appropriate source
				$('#auth-iframe-wrapper iframe').attr('src', spark.auth.getAuthLoginUrl());
			}
		}

	});

</script>

</body>
</html>
