<!DOCTYPE html>
<html lang="en">
<head>
	<title>Spark Sample Application</title>
	<meta charset="utf-8">

	<!-- fonts -->
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:300,600,400' rel='stylesheet' type='text/css'>

	<!-- Bootstrap core CSS -->
	<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">

	<!-- Common styles, also cloudfront-->
	<link href="../../../assets/css/common.css" rel="stylesheet">

	<style>
		.si-asset-folder-icon {
			margin-bottom: -3px;
		}
	</style>

</head>

<body>
<div class="container">

	<div class="spinner"></div>

	<div class="hidden" id="assets-files">
		<table class="table">
			<thead>
			<tr>
				<th>Reference<br/><span></span></th>
				<th>Contains<br/><span></span></th>
			</tr>
			</thead>
			<tbody id="assetsTbody">
			<tr class="in-table thumbnails">
				<td><i class="spark_icon si-asset-folder-icon"></i>Thumbnail files</td>
				<td id="thumbnail-count">Empty</td>
			</tr>
			<tr class="in-table sources">
				<td><i class="spark_icon si-asset-folder-icon"></i>Source files</td>
				<td id="sources-count">Empty</td>
			</tr>
			</tbody>
		</table>
	</div>

</div>
<!-- /container -->


<script type="text/javascript" charset="utf-8" src="//code.jquery.com/jquery-2.1.3.min.js"></script>
<script type="text/javascript" charset="utf-8"
        src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

<!-- your config file -->
<script type="text/javascript" charset="utf-8" src="../../../assets/scripts/config.js"></script>

<!-- spark sdk -->
<script type="text/javascript" charset="utf-8" src="../../../vendor/spark/spark-config.js"></script>
<script type="text/javascript" charset="utf-8" src="../../../vendor/spark/utilities.js"></script>
<script type="text/javascript" charset="utf-8" src="../../../vendor/spark/spark-auth.js"></script>
<script type="text/javascript" charset="utf-8" src="../../../vendor/spark/spark-drive.js"></script>

<script>

	//the asset id we are referring to
	var currentAssetId;

	/**
	 * Fetch the asset and it's metadata and set data in the DOM
	 */
	function setUpAssetFiles(){
		spark.drive.getAsset(currentAssetId, function(asset){
			console.info('asset response was:', asset);
			$('.spinner').hide();
			$('#assets-files').removeClass('hidden');

			//for empty thumbnails the file_id of the first thumbnail is 0
			if (asset.thumbnails.length > 0 && asset.thumbnails[0].file_id){
				$('#thumbnail-count').text(asset.thumbnails.length + ' file' + (asset.thumbnails.length>1?'s':''));
			}

			//for empty sources the id of the first source is 999
			if (asset.file_formats.length > 0 && asset.file_formats[0].id !== 999){
				$('#sources-count').text(asset.thumbnails.length + ' file' + (asset.thumbnails.length>1?'s':''));
			}

		});

		//set up the links
		$('tr.thumbnails').on('click', function(){
			location.href = '../show-asset-thumbnails/?assetId=' + currentAssetId;
		});

		$('tr.sources').on('click', function(){
			location.href = '../show-asset-sources/?assetId=' + currentAssetId;
		});
	}


	/**
	 * Run when DOM is ready.
	 * The spark object already exists in this point
	 */
	jQuery(function ($) {

		//First let's see if we have a valid access token
		if (!spark.auth.isAccessTokenValid()) {
			location.href = '../../auth/';
		}else {
			//Assume we provided assetId in URL
			var urlParams = spark.util.extractParamsFromURL();
			currentAssetId = urlParams['assetId'] ? urlParams['assetId'] : 0;

			if (!currentAssetId) {
				location.href = '../show-my-assets/';
			} else {
				setUpAssetFiles();
			}
		}

	});

</script>

</body>
</html>
