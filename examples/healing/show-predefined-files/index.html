<!DOCTYPE html>
<html lang="en">
<head>
	<title>Spark Sample Application - Show My Assets - files</title>
	<meta charset="utf-8">

	<!-- fonts -->
	<link href='//fonts.googleapis.com/css?family=Open+Sans:300,600,400' rel='stylesheet' type='text/css'>

	<!-- Bootstrap core CSS -->
	<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">

	<!-- Common styles -->
	<link href="../../../assets/css/common.css" rel="stylesheet">

	<style>

	</style>

</head>

<body>
<div class="container">

	<div class="spinner"></div>

	<div class="hidden" id="assets-files">
		<table class="table">
			<thead>
			<tr>
				<th>Name<br/><span></span></th>
				<th>Description<br/><span></span></th>
				<th>Size<br/><span></span></th>

			</tr>
			</thead>
			<tbody id="assetsTbody">

			</tbody>
		</table>
	</div>

</div>
<!-- /container -->


<script type="text/javascript" charset="utf-8" src="//code.jquery.com/jquery-2.1.3.min.js"></script>
<script type="text/javascript" charset="utf-8"
        src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" charset="utf-8" src="../../../vendor/spark-js-sdk/sdk/bower_components/promise-polyfill/Promise.min.js"></script>

<!-- spark sdk -->
<script type="text/javascript" charset="utf-8" src="../../../vendor/spark-js-sdk/sdk/src/config/Constants.js"></script>
<script type="text/javascript" charset="utf-8" src="../../../vendor/spark-js-sdk/sdk/src/utilities/Helpers.js"></script>
<script type="text/javascript" charset="utf-8" src="../../../vendor/spark-js-sdk/sdk/src/utilities/Request.js"></script>
<script type="text/javascript" charset="utf-8" src="../../../vendor/spark-js-sdk/sdk/src/Client.js"></script>
<script type="text/javascript" charset="utf-8" src="../../../vendor/spark-js-sdk/sdk/src/drive/Members.js"></script>
<script type="text/javascript" charset="utf-8" src="../../../vendor/spark-js-sdk/sdk/src/drive/Assets.js"></script>
<script type="text/javascript" charset="utf-8" src="../../../vendor/spark-js-sdk/sdk/src/drive/Files.js"></script>

<!-- OR use the minified version
<script type="text/javascript" charset="utf-8" src="//code.spark.autodesk.com/autodesk-spark-sdk-0.1.0.min.js"></script>
-->

<!-- your config file and initialization -->
<script type="text/javascript" charset="utf-8" src="../../../assets/scripts/config.js"></script>
<script type="text/javascript" charset="utf-8" src="../../../assets/scripts/init.js"></script>


<!-- Enable broadcasting events and logging requests to top window -->
<script type="text/javascript" charset="utf-8" src="../../../plugins/broadcaster/eventBroadcaster.js"></script>
<script type="text/javascript" charset="utf-8" src="../../../plugins/ajaxlogger/ajaxCallListener.js"></script>

<script>

	//log http requests
	ajaxCallListenerFromIframe();

	//the asset id we are referring to
	var currentAssetId;

	var predefinedAssets = [
		{
			name:"PepperHolesWithInconsistentlyOriented",
			description:"10 Holes, 100 Duplicate Triangles, 50 non-manifold vertices",
			size:"0.2MB",
			fileId:17729449
		},
		{
			name:"001_a5multiple",
			description:"10 Holes, 100 Duplicate Triangles, 50 non-manifold vertices",
			size:"0.5MB",
			fileId:17729499
		},
		{
			name:"elephantLittle_elephant",
			description:"10 Holes, 100 Duplicate Triangles, 50 non-manifold vertices",
			size:"0.3MB",
			fileId:17734456
		}
	];
	/**
	 * Fetch the asset and it's metadata and set data in the DOM
	 */
	function setupAssetFiles(){
		$('.spinner').hide();
		$('#assets-files').removeClass('hidden');
		$.each(predefinedAssets, function (index, item) {

			var tr = $('<tr class="in-table"></tr>');
			tr.append($('<td><i class="spark_icon si-asset-file-icon"></i>' + item.name + '</td>'));
			tr.append($('<td>' + item.description + '</td>'));
			tr.append($('<td>' + item.size + '</td>'));

			/**
			var actionsElem = '<div class="dropdown actions">' +
					'<i class="spark_icon si-actions-icon" id="dropdownMenu1" data-toggle="dropdown" aria-expanded="true"></i>' +
					'<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">' +
					'<li role="presentation"><a role="menuitem" onclick="deleteSourceFromAsset(' + currentAssetId + ',' + item.file_id + ',$(this).parents(\'tr\'))"">DELETE</a></li>' +
					'</ul></div>';


			tr.append($('<td>' + actionsElem + '</td>'));
			 */

			$(tr).on('click', function(e){

				window.location.href = "../upload.html?fileId=" + item.fileId;
			});

			$('#assetsTbody').append(tr);
		});

		/**
		ADSKSpark.Assets.getAsset(currentAssetId).then(function(asset){
			console.info('asset response was:', asset);
			$('.spinner').hide();
			$('#assets-files').removeClass('hidden');

			//for empty sources the id of the first source is 999
			if (asset.file_formats.length > 0 && asset.file_formats[0].id !== 999) {
				$('#files').removeClass('hidden');
				$.each(asset.file_formats, function (index, item) {

					var tr = $('<tr class="in-table"></tr>');
					tr.append($('<td><i class="spark_icon si-asset-file-icon"></i>' + item.file_name + '</td>'));
					tr.append($('<td>' + item.file_id + '</td>'));

					var actionsElem = '<div class="dropdown actions">' +
							'<i class="spark_icon si-actions-icon" id="dropdownMenu1" data-toggle="dropdown" aria-expanded="true"></i>' +
							'<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">' +
							'<li role="presentation"><a role="menuitem" onclick="deleteSourceFromAsset(' + currentAssetId + ',' + item.file_id + ',$(this).parents(\'tr\'))"">DELETE</a></li>' +
							'</ul></div>';


					tr.append($('<td>' + actionsElem + '</td>'));

					$(tr).on('click', function(e){

						window.location.href = "../upload.html?fileId=" + item.file_id;
					});

					$('#assetsTbody').append(tr);
				});
			} else {
				$('#empty-files').removeClass('hidden');
				$('.upload-link').attr('href', $('.upload-link').attr('href') + '?assetId=' + currentAssetId);

				//broadcast the state to the iframe - intended only for the storage UI
				eventBroadCaster.broadcastEvent('emptyAssets');
				});
			}*/




		//set up the links
		$('tr.thumbnails').on('click', function(){
			location.href = '../show-asset-thumbnails/?assetId=' + currentAssetId;
		});

		$('tr.sources').on('click', function(){
			location.href = '../show-asset-sources/?assetId=' + currentAssetId;
		});
	}


	/**
	 * Run when DOM is ready.
	 * The spark object already exists in this point
	 */
	jQuery(function ($) {

		//First let's see if we have a valid access token
		if (!ADSKSpark.Client.isAccessTokenValid()) {
			location.href = '../../../plugins/login/login.html';
		}else {
			//Assume we provided assetId in URL
			var urlParams = ADSKSpark.Helpers.extractParamsFromURL();
			currentAssetId = urlParams['assetId'] ? urlParams['assetId'] : 1497477;

			if (currentAssetId) {
				setupAssetFiles();
			}
		}

		//broadcast the state to the iframe - intended only for the storage UI
		eventBroadCaster.broadcastEvent('showMyAssets.files',{assetId:currentAssetId});

	});

</script>

</body>
</html>
