<!DOCTYPE html>
<html lang="en">
<head>
	<title>Spark Sample Application - Show Asset Sources</title>
	<meta charset="utf-8">

	<!-- fonts -->
	<link href='//fonts.googleapis.com/css?family=Open+Sans:300,600,400' rel='stylesheet' type='text/css'>

	<!-- Bootstrap core CSS -->
	<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">

	<!-- Common styles-->
	<link href="../../assets/css/common.css" rel="stylesheet">

	<style>


	</style>

</head>

<body>
<div class="half-container">

	<div id="content" class="container-fluid">
		<div  class="row">
			<h1 class="text-center">Print Sample</h1>
			<div class="" id="btn-div">
				<button class="btn btn-primary btn-file">
					<input class="btn btn-primary btn-file" id="file-select" type="file">

				</button>
				<input id="file-name" type="text" hidden readonly>
				<button id="import" type="button" class="btn btn-primary">Import Mesh</button>

				<button id="continue" type="button" onclick="eventBroadCaster.broadcastEvent('importIframe.continueClick')" class="btn btn-primary">Continue</button>

				<br/><br/>
				</div></div></div>

</div>
<!-- /container -->


<script type="text/javascript" charset="utf-8" src="//code.jquery.com/jquery-2.1.3.min.js"></script>
<script type="text/javascript" charset="utf-8"
        src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

<!-- spark sdk -->
<script type="text/javascript" charset="utf-8" src="../../vendor/spark-js-sdk/sdk/src/config/Constants.js"></script>
<script type="text/javascript" charset="utf-8" src="../../vendor/spark-js-sdk/sdk/src/utilities/Helpers.js"></script>
<script type="text/javascript" charset="utf-8" src="../../vendor/spark-js-sdk/sdk/src/utilities/Request.js"></script>
<script type="text/javascript" charset="utf-8" src="../../vendor/spark-js-sdk/sdk/src/Client.js"></script>
<script type="text/javascript" charset="utf-8" src="../../vendor/spark-js-sdk/sdk/src/drive/Members.js"></script>
<script type="text/javascript" charset="utf-8" src="../../vendor/spark-js-sdk/sdk/src/drive/Assets.js"></script>
<script type="text/javascript" charset="utf-8" src="../../vendor/spark-js-sdk/sdk/src/drive/Files.js"></script>


<script type="text/javascript" charset="utf-8" src="../../assets/scripts/config.js"></script>
<script type="text/javascript" charset="utf-8" src="../../vendor/spark/spark-print-prep.js"></script>
<script type="text/javascript" charset="utf-8" src="../../vendor/spark/spark-config.js"></script>
<script type="text/javascript" charset="utf-8" src="../../vendor/spark/spark-auth.js"></script>
<script type="text/javascript" charset="utf-8" src="../../vendor/spark/spark-drive.js"></script>
<script type="text/javascript" charset="utf-8" src="../../vendor/spark/utilities.js"></script>

<!-- OR use the minified version
<script type="text/javascript" charset="utf-8" src="//spark-dev-portal-stg.s3.amazonaws.com/sdk/autodesk-spark-sdk-latest.min.js"></script>
-->
<!-- your config file and initialization -->
<script type="text/javascript" charset="utf-8" src="../../assets/scripts/config.js"></script>
<script type="text/javascript" charset="utf-8" src="../../assets/scripts/init.js"></script>

<!-- Enable broadcasting events and logging requests to top window -->
<script type="text/javascript" charset="utf-8" src="../../plugins/broadcaster/eventBroadcaster.js"></script>
<script type="text/javascript" charset="utf-8" src="../../plugins/ajaxlogger/ajaxCallListener.js"></script>

<script>

	//log http requests
	ajaxCallListenerFromIframe();

	//the asset id we are referring to
	var currentAssetId;

	//Init the Spark Client
	var APP_KEY = APP_KEY || '',
			GUEST_TOKEN_URL = GUEST_TOKEN_URL || 'http://localhost:3000/guest_token',
			ACCESS_TOKEN_URL = ACCESS_TOKEN_URL || 'http://localhost:3000/access_token';

	ADSKSpark.Client.initialize(APP_KEY,// Your app key
			GUEST_TOKEN_URL,// The guest token endpoint that is implemented by your server (i.e. http://example.com/guest_token)
			ACCESS_TOKEN_URL,// The access token endpoint that is implemented by your server (i.e. http://example.com/access_token)
			REFRESH_TOKEN_URL,// The access token endpoint that is implemented by your server (i.e. http://example.com/access_token)

			ADSKSpark.Constants.API_HOST_SANDBOX // api host - production or sandbox
	);

	/**
	 * Run when DOM is ready.
	 * The spark object already exists in this point
	 */
	jQuery(function ($) {

		//First let's see if we have a valid access token
		if (!ADSKSpark.Client.isAccessTokenValid()) {
			location.href = '../../plugins/login/login.html';
		} else {
			//Assume we provided assetId in URL
			var urlParams = ADSKSpark.Helpers.extractParamsFromURL();
			currentAssetId = urlParams['assetId'] ? urlParams['assetId'] : 0;
			currentAssetId="123";
			if (!currentAssetId) {
				location.href = '../show-my-assets/';
			} else {


			}
		}

		$( "#import" ).click(function() {
			//disableButtons();
			var fileSelect = document.getElementById('file-select');
			var files = fileSelect.files;
			sparkPrintPrep.uploadFileAndImport(files,function(response){
				console.log(response);
				document.getElementById('meshId').value = response.id;
				EnableButtons();
			});
		});

		//broadcast the state to the iframe - intended only for the storage UI
		//eventBroadCaster.broadcastEvent('showAssetFiles', {fileType: 'sources', assetId: currentAssetId});

	});

</script>

</body>
</html>