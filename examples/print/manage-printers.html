<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content="">

	<title>Spark Sample Application - My Drive</title>


	<!-- fonts -->
	<link href='//fonts.googleapis.com/css?family=Open+Sans:300,600,400' rel='stylesheet' type='text/css'>

	<!-- Bootstrap core CSS -->
	<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">

	<!-- Custom styles -->
	<!--<link href="../../assets/css/styleOld.css" rel="stylesheet">-->
	<link href="../../assets/css/common.css" rel="stylesheet">

	<script type="text/javascript" charset="utf-8" src="../../assets/scripts/config.js"></script>
	<script type="text/javascript" charset="utf-8" src="../../vendor/spark/spark-config.js"></script>
	<script type="text/javascript" charset="utf-8" src="../../vendor/spark/spark-auth.js"></script>

	<script type="text/javascript" charset="utf-8" src="../../vendor/jquery/jquery.min.js"></script>
	<script type="text/javascript" charset="utf-8" src="../../vendor/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" charset="utf-8" src="../../plugins/broadcaster/eventBroadcaster.js"></script>

</head>

<body>

<div class="logged-in-container">
	<div class="container">
		<div class="spacer clearfix"></div>
		<div class="spinner"></div>
		<form id="print-status-form">
			<div class="sample-title pull-left">Manage your 3D Printers</div>
			<a class="spark_btn primary pull-right" onclick="eventBroadCaster.broadcastEvent('manageIframe.addClick')">
				<i class="spark_icon si-add-item"></i>  Add Printer
			</a>
			<div class="spacer clearfix"></div>
			<hr>
			<table class="table hidden" id="printers">
				<thead>
				<tr>
					<!--<th>Printer ID<br><span>Printer ID</span></th>-->
					<th>Printer Name<br><span>printer_name</span></th>
					<th>Printer Type<br><span>type_id</span></th>
					<!--<th>Registration Date<br><span>Registration Date</span></th>-->
					<th>Firmware<br><span>firmware</span></th>
					<th></th>
				</tr>
				</thead>
				<tbody id="printersTbody">
			</table>
		</form>

		<div class="hidden" id="empty-printers">
			<p>Assets are objects referencing all the files and data related to a 3D model.<br/>
				They are equivelent to a project or a folder with metadata.
			</p>

			<div class="img">
				<img src="../../../assets/img/my_assets_illustration.png" alt="my assets illustrations"/>
			</div>
			<a class="spark_btn" href="../create-asset/">Create your first Printer</a>
		</div>

		<div class="modal-footer">
			<input class="btn btn-primary" onclick="eventBroadCaster.broadcastEvent('manageIframe.continueClick')" value="Contintue">
		</div>
	</div>
</div>
<!-- /container -->

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4>WARNING</h4>
			</div>
			<div class="modal-body">
				Are you sure you want to delete this Printer?
			</div>
			<div class="modal-footer">
				<a class="spark_btn small cancel" type="button">CANCEL</a>
				<a class="spark_btn primary small delete" type="button">DELETE PRINTER</a>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript" charset="utf-8" src="../../vendor/spark/utilities.js"></script>
<script type="text/javascript" charset="utf-8" src="../../vendor/spark/spark-printer.js"></script>

<script type="text/javascript" charset="utf-8" src="../../plugins/login/login.js"></script>

<script type="text/javascript" charset="utf-8" src="../../plugins/ajaxlogger/ajaxCallListener.js"></script>

<script type="text/javascript">


	/**
	 * Delete a printer
	 */
	function deletePrinter(printer_id, printerElem) {

		$('#myModal').modal('show');

		//cancel events
		$('.cancel').off();
		$('.cancel').on('click', function(){
			$('#myModal').modal('hide');
		});

		//delete events
		$('.delete').off();
		$('.delete').on('click',function(){
			sparkPrint.unregisterPrinter(printer_id, function () {
				$('#myModal').modal('hide');
				printerElem.remove();

				//make sure printers still left
				if (!$('.in-table td').length){
					location.reload();
				}
			}, function(){});
		});
	}


	function getAllPrinters(){
		sparkPrint.getAllPrinters(function(response){

			$('.spinner').hide();

			$('#printersTbody').empty();


			if (response.count) {

				$('#printers').removeClass('hidden');

				$.each(response.printers, function (index, item) {

					sparkPrint.getPrinterTypeById(item.type_id, function (type) {

						var tr = $('<tr class="in-table"></tr>')
						tr.append($('<td>' + item.printer_name + '</td>'));
						tr.append($('<td>' + type.name + '</td>'));
						tr.append($('<td>' + item.firmware + '</td>'));

						var actionsElem = '<div class="dropdown actions">' +
								'<i class="spark_icon si-actions-icon" id="dropdownMenu1" data-toggle="dropdown" aria-expanded="true"></i>' +
								'<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">' +
								'<li role="presentation"><a role="menuitem" href="../update-printer/?printerId=' + item.printer_id + '">EDIT</a></li>' +
								'<li role="presentation"><a role="menuitem" onclick="deletePrinter(' + item.printer_id + ',$(this).parents(\'tr\'))">DELETE</a></li>' +
								'</ul></div>';


						tr.append($('<td>' + actionsElem + '</td>'));
						$('#printersTbody').append(tr);

					});

				});
			}else {
				$('#empty-printers').removeClass('hidden');
			}

		}, function(){
			console.log("error get printers");
		});

	};




	$(document).ready(function() {

		ajaxCallListenerFromIframe();
		getAllPrinters();
	});

</script>
</body>
</html>
