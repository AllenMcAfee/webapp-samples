<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content="">

	<title>Spark Sample Application - My Drive</title>

	<!-- Bootstrap core CSS -->
	<link href="../../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

	<!-- Custom styles -->
	<link href="../../assets/css/styleOld.css" rel="stylesheet">

	<script type="text/javascript" charset="utf-8" src="../../assets/scripts/config.js"></script>
	<script type="text/javascript" charset="utf-8" src="../../vendor/spark/spark-config.js"></script>
	<script type="text/javascript" charset="utf-8" src="../../vendor/spark/spark-auth.js"></script>

	<script type="text/javascript" charset="utf-8" src="../../vendor/jquery/jquery.min.js"></script>
	<script type="text/javascript" charset="utf-8" src="../../vendor/bootstrap/js/bootstrap.min.js"></script>
</head>

<body>

<div class="logged-in-container">
	<div class="container">



		<form id="print-status-form">
		<h1>Check Status</h1>

		<div class="form-group">
			<label for="printers-select">Printer name</label>
			<select class="form-control" id="printers-select" required>
			</select>
		</div>

		<table class="table table-condensed" id="print-statuses">

			<tr class="header">
				<td>Job ID</td>
				<td>Job Date</td>
				<td>Status</td>
				<td>Actions</td>
			</tr>

		</table>

		<br/> <br/>

	</form>






		<div class="footer">
			<p>&copy; Spark Sample Application 2015</p>
		</div>

	</div></div>
<!-- /container -->

<script type="text/javascript" charset="utf-8" src="../../vendor/spark/utilities.js"></script>
<script type="text/javascript" charset="utf-8" src="../../vendor/spark/spark-printer.js"></script>

<script type="text/javascript" charset="utf-8" src="../../plugins/login/login.js"></script>

<script type="text/javascript" charset="utf-8" src="../../plugins/ajaxlogger/ajaxCallListener.js"></script>

<script type="">
	$(document).ready(function(){
			ajaxCallListener(function(data){
				parent.postMessage(data,"*");
			});
	});

	var getAllPrinters = function(){
		sparkPrint.getAllPrinters(function(response){
			var printers = response.printers;
			$("#printers-select").find('option').remove()

			for(var i in printers){
				$("<option value='"+printers[i].printer_id+"'>"+printers[i].printer_id+":"+printers[i].printer_name+"</option>").appendTo("#printers-select")
			}
		});
	};


	getAllPrinters();


	$("#printers-select").on('change', function (e) {
		e.preventDefault();

		var printerId = $('#printers-select').val();

		sparkPrint.getJobsStatusByPrinter(printerId,function(response){
					$("#print-statuses").find("tr:not(.header)").remove();
					//var printerId = response.printer_id;
					var printerJobs = response.printer_jobs;
					for(var i in printerJobs){
						$("<tr class='"+ classMapper[printerJobs[i].job_status.job_status]+"'><td>"+printerJobs[i].job_id+"</td><td>"+printerJobs[i].job_date_time+"</td><td>"+printerJobs[i].job_status.job_status+"</td><td>"+
								'<button type="button" class="btn btn-default resume-print" onclick="sendPrinterCommand(\''+printerJobs[i].job_id+'\',\'resume\')"><span class="glyphicon glyphicon-play" aria-hidden="true"></span>	</button>'+
								'<button type="button" class="btn btn-default pause-print"   onclick="sendPrinterCommand(\''+printerJobs[i].job_id+'\',\'pause\')"><span class="glyphicon glyphicon-pause" aria-hidden="true"></span></button>'+
								'<button type="button" class="btn btn-default cancel-print"  onclick="sendPrinterCommand(\''+printerJobs[i].job_id+'\',\'cancel\')"><span class="glyphicon glyphicon-stop" aria-hidden="true"></span></button>' +
								"</td></tr>").appendTo("#print-statuses");
					}

					//logger("#inputLogStatus","Got "+ printerJobs.length +" jobs!");

				},
				function(response){
					//logger("#inputLogStatus",response);

				});
	});

	var classMapper = {
		"completed":"success",
		"queued":"warning",
		"started":"info",
		"canceled":"danger",
		"printing":"info"
	};

	var sendPrinterCommand = function(jobId, command){
		sparkPrint.sendPrintCommand($("#printers-select").val(),jobId,command,function(response){
					logger("#inputLogStatus","Successfully sent " + command + " command to printer "+$("#printers-select").val());
				}
				,function(response){
					logger("#inputLogStatus",response);
					logger("#inputLogStatus","Error sending " + command + " command to printer "+$("#printers-select").val());
				});
	}

</script>









</body>
</html>
