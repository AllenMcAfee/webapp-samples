<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content="">

	<title>Object Repair Tool</title>

	<!-- fonts -->
	<link href='//fonts.googleapis.com/css?family=Open+Sans:300,600,400' rel='stylesheet' type='text/css'>

	<!-- Bootstrap core CSS -->
	<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">

	<!-- Custom styles -->
	<link href="assets/css/common.css" rel="stylesheet">

	<style>
	.mainIframe-container{
		margin-bottom: 15px;
		border: 1px solid #cccccc;
	}

	</style>
</head>

<body>

<div class="logged-in-container">
	<div class="container outer-container">
		<div id="container" class="container sample-app-container">
			<div class="sample-app-header clearfix">
				<h5 class="sample-title">Object Repair Tool</h5>
			</div>
			<div style="text-align: center;">
				<ul class="nav nav-tabs sample-top-menu" role="tablist">
					<li id="loginId">
						<div id="user" class="pull-left" style="display: none;">
							<img class="user-avatar" src=""/>
						</div>
						<a class="menu-item pull-left" data-state="login" role="tab" onclick='statePlugin.changeState("login");'>Log in</a>

						<div class="pull-left spark_icon si-status-ok">&nbsp;</div>
						<div class="pull-left spark_icon si-status-disabled">&nbsp;</div>
						<div class="pull-left spark_icon si-status-right-arrow"></div>
					</li>
					<li id="uploadId">
						<a class="menu-item pull-left" data-state="upload" role="tab" onclick='statePlugin.changeState("upload");'>Upload</a>

						<div class="pull-left spark_icon si-status-ok">&nbsp;</div>
						<div class="pull-left spark_icon si-status-disabled">&nbsp;</div>
						<div class="pull-left spark_icon si-status-right-arrow"></div>
					</li>
					<li id="analyzeId">
						<a class="menu-item pull-left" data-state="analyze" role="tab">Analyze</a>

						<div class="pull-left spark_icon si-status-ok">&nbsp;</div>
						<div class="pull-left spark_icon si-status-disabled">&nbsp;</div>
						<div class="pull-left spark_icon si-status-right-arrow"></div>
					</li>
					<li id="repairId">
						<a class="menu-item pull-left" data-state="repair" role="tab">Repair</a>
						<div class="pull-left spark_icon si-status-ok">&nbsp;</div>
						<div class="pull-left spark_icon si-status-disabled">&nbsp;</div>

					</li>
				</ul>
			</div>
			<div class="mainIframe-container">
				<iframe name="mainIframe" id="mainIframe" scrolling="no" width="680px" height="523px" frameborder="0"
				        src=""></iframe>
			</div>



			<div class="footer"></div>
		</div>
	</div>
</div>


<!-- /container -->



<!-- Modal -->
<!--
<div class="modal fade" id="appModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
						aria-hidden="true">&times;</span></button>
				<h2>Spark Sample App</h2>
			</div>
			<div class="modal-body">
				This is an open source Print API demo sample app.
			</div>
			<div class="modal-footer">
				<a class="spark_btn primary large" type="button" onclick="$('#appModal').modal('hide')">Run the sample code</a>
			</div>
		</div>
	</div>
</div>
-->
<script type="text/javascript" charset="utf-8" src="assets/scripts/config.js"></script>

<script type="text/javascript" charset="utf-8" src="vendor/spark-js-sdk/sdk/bower_components/promise-polyfill/Promise.min.js"></script>

<!-- spark sdk -->
<script type="text/javascript" charset="utf-8" src="vendor/spark-js-sdk/sdk/src/config/Constants.js"></script>
<script type="text/javascript" charset="utf-8" src="vendor/spark-js-sdk/sdk/src/utilities/Helpers.js"></script>
<script type="text/javascript" charset="utf-8" src="vendor/spark-js-sdk/sdk/src/utilities/Request.js"></script>
<script type="text/javascript" charset="utf-8" src="vendor/spark-js-sdk/sdk/src/Client.js"></script>
<script type="text/javascript" charset="utf-8" src="vendor/spark-js-sdk/sdk/src/drive/Members.js"></script>
<script type="text/javascript" charset="utf-8" src="vendor/spark-js-sdk/sdk/src/drive/Assets.js"></script>
<script type="text/javascript" charset="utf-8" src="vendor/spark-js-sdk/sdk/src/drive/Files.js"></script>

<script type="text/javascript" charset="utf-8" src="vendor/spark/spark-config.js"></script>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script type="text/javascript" charset="utf-8" src="vendor/bootstrap/js/bootstrap.min.js"></script>
<!--<script type="text/javascript" charset="utf-8" src="plugins/portalSimulator/faye-browser.js"></script>
<script type="text/javascript" charset="utf-8" src="plugins/portalSimulator/printer.js"></script>-->

<script type="text/javascript" charset="utf-8" src="vendor/spark/utilities.js"></script>
<script type="text/javascript" charset="utf-8" src="vendor/spark/spark-printer.js"></script>

<script type="text/javascript" charset="utf-8" src="plugins/ajaxlogger/renderjson.js"></script>
<script type="text/javascript" charset="utf-8" src="plugins/ajaxlogger/ajaxCallListener.js"></script>

<script type="text/javascript" charset="utf-8" src="plugins/ajaxlogger/ajaxCallLogger.js"></script>

<script type="text/javascript" charset="utf-8" src="plugins/state/statePlugin.js"></script>
<script type="text/javascript" charset="utf-8" src="plugins/broadcaster/broadcastEventListener.js"></script>

<script type="text/javascript" charset="utf-8" src="assets/scripts/init.js"></script>

<script>

	$(document).ready(function(){
		//ajaxCallLogger.createLoggerElement(".footer");
		//ajaxCallLogger.startIframeListener();

		broadcastEventListener.startIframeBroadcastListener();

		if (ADSKSpark.Client.isAccessTokenValid()) {
			isLoggedIn = true;
			statePlugin.changeState('upload');
			statePlugin.verifyState("login");
			//$('#mainIframe').attr('height', '462px');

			ADSKSpark.Members.getMyProfile().then(function(response){
				if (response.member.profile.avatar_path) {
					$('#user img').attr('src', ADSKSpark.Helpers.changeHttpToHttps(response.member.profile.avatar_path));
					$('#user').show();
				}
				else{
					$('#user img').attr('src', ADSKSpark.Helpers.changeHttpToHttps("../../assets/img/default_avatar.png"));
					$('#user').show();
				}
			});
		}
		else{
			$('#appModal').modal('show');
			isLoggedIn = false;
			statePlugin.changeState('login');
			//$('#mainIframe').attr('height', '523px');
		}

	});


	var loggedOutCallback = function(){
		//$('#mainIframe').attr('height', '523px');
	}

	var states = {
		login:{
			src:"plugins/login/login.html",
			selectedTab:"#loginId",
			enabledTabs:[],
			disabledTabs:["#loginId", "#uploadId","#analyzeId", "#repairId"],
			callbackFunc: function () {
				$('#uploadId').removeClass("verified");
				$('#analyzeId').removeClass("verified");
				$('#repairId').removeClass("verified");

			}
		},

		upload:{
			src:"examples/healing/upload.html",
			selectedTab:"#uploadId",
			enabledTabs:["#loginId", "#uploadId"],
			disabledTabs:["#analyzeId","#repairId"],
			callbackFunc: function () {
				$('#analyzeId').removeClass("verified");
				$('#repairId').removeClass("verified");
			}
		},

		analyze:{
			selectedTab:"#analyzeId",
			enabledTabs:["#loginId", "#uploadId","#analyzeId"],
			disabledTabs:["#repairId"]
		},


		repair:{
			selectedTab:"#repairId",
			enabledTabs:["#loginId", "#uploadId","#analyzeId", "#repairId"],
			disabledTabs:[]
		}

	};

	/**
	var showSimulator = function(show){
		if(show == true){
			$('.simulator-container').animate({height: 'show'}, 290);
		}
		else{
			$('.simulator-container').animate({height: 'hide'}, 290);
		}
	};*/

	var isLoggedIn = false;

	var broadcastMapper = [];

	broadcastMapper['manageIframe.loggedOut']  = function(optionalParams){
		isLoggedIn = false;
		$('#user').hide();
		statePlugin.changeState('login');
		statePlugin.unVerifyAll();
	};

	broadcastMapper["manageIframe.loggedIn"] = function(optionalParams){

		if(!isLoggedIn || (optionalParams && optionalParams.forceRedirect)) {
			statePlugin.changeState("upload", optionalParams);
			statePlugin.verifyState("login");
			isLoggedIn = true;
		}
	};

	broadcastMapper["repairIframe.analyze"] = function(optionalParams){
		statePlugin.changeState("analyze", optionalParams);
		statePlugin.verifyState("upload");
		//statePlugin.verifyState("analyze");

	};


	broadcastMapper["repairIframe.repair"] = function(optionalParams){
		statePlugin.changeState("repair", optionalParams);
		statePlugin.verifyState("analyze");
		//statePlugin.verifyState("analyze");

	};

	broadcastMapper["repairIframe.repaired"] = function(optionalParams){
		console.log("in repairedrepairedrepairedrepaired")
		statePlugin.changeState("repair", optionalParams);

		statePlugin.verifyState("repair");
		//statePlugin.verifyState("analyze");

	};

</script>





</body>
</html>
