<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content="">

	<title>Spark Sample Application - My Drive</title>

	<!-- fonts -->
	<link href='//fonts.googleapis.com/css?family=Open+Sans:300,600,400' rel='stylesheet' type='text/css'>

	<!-- Bootstrap core CSS -->
	<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">

	<!-- Common styles -->
	<link href="assets/css/common.css" rel="stylesheet">

	<style>

	</style>
</head>

<body>

<div class="logged-in-container">
	<div class="container sample-app-container" id="container">

		<div class="header">
			<a class="btn pull-right view-source" href="" target="_blank">View on github</a>
			<!-- Navigation links at the top right of the screen -->
			<h5 class="sample-title">Spark Print Sample App</h5>
		</div>

		<ul class="nav nav-tabs sample-top-menu" role="tablist">
			<li><a id="loginId" class="menu-item" data-state="login" role="tab">Login</a></li>
			<li><a id="myAssetsId" class="menu-item" data-state="myAssets" role="tab">My Assets</a></li>
			<li><a id="createAssetId" class="menu-item" data-state="createAsset" role="tab">Create Asset</a></li>
			<li><a id="manageFilesId" class="menu-item" data-state="manageFiles" role="tab">Manage Files</a></li>
		</ul>


		<div id="breadcrumbs-section">
			<div id="breadcrumbs">
				<div class="bread-crumb" id="home">
					<a onclick="changeState('myAssets')">
						<span class="bread-crumb-inner"><i class="spark_icon si-home"></i></span>
					</a>
				</div>

				<div class="bread-crumb hidden" id="asset">
					<p class="bread-crumb-tail"></p>
					<a onclick="showMyAssetFiles()">
						<span class="bread-crumb-inner"></span>
					</a>
				</div>
				<div class="bread-crumb hidden" id="file-type">
					<p class="bread-crumb-tail"></p>
					<a disabled>
						<span class="bread-crumb-inner"></span>
					</a>
				</div>

			</div>
			<div id="action-button">
				<div id="create-asset">
					<a onclick="changeState('createAsset')" class="spark_btn primary">
						<i class="spark_icon si-asset-icon-transparent"></i>CREATE ASSET
					</a>
				</div>
				<div id="create-file" class="dropdown actions">
					<a class="spark_btn primary" onclick="openUploadFileMenu(this)" id="dropdownMenu1" data-toggle="dropdown"
					   aria-expanded="true">
						<i class="spark_icon si-add-item" data-toggle="dropdown" aria-expanded="true"></i>Add File
					</a>
					<i class="spark_icon si-dropdown-open"></i>

					<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
						<li role="presentation">
							<a role="menuitem" onclick="goToUploadFilePage('source')">SOURCE FILE</a>
							<i class="spark_icon si-help with_hover"></i>
							<i class="stooltip"><span>Asset sources</span></i>
						</li>
						<li role="presentation">
							<a role="menuitem" onclick="goToUploadFilePage('thumb')">THUMBNAIL FILE</a>
							<i class="spark_icon si-help with_hover"></i>
							<i class="stooltip"><span>Asset thumbnails</span></i>
						</li>
					</ul>
				</div>
			</div>
		</div>
		<iframe name="mainIframe"
		        id="mainIframe"
		        width="768px"
		        height="500px"
		        frameborder="0"
		        src="#"></iframe>

		<div class="footer"></div>
	</div>

</div>

<!-- /container -->

<script type="text/javascript" charset="utf-8" src="//code.jquery.com/jquery-2.1.3.min.js"></script>
<script type="text/javascript" charset="utf-8"
        src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

<script type="text/javascript" charset="utf-8" src="assets/scripts/config.js"></script>

<script type="text/javascript" charset="utf-8" src="assets/scripts/common.js"></script>

<script type="text/javascript" charset="utf-8" src="vendor/spark/spark-config.js"></script>
<script type="text/javascript" charset="utf-8" src="vendor/spark/spark-auth.js"></script>

<script type="text/javascript" charset="utf-8" src="plugins/ajaxlogger/renderjson.js"></script>
<script type="text/javascript" charset="utf-8" src="plugins/ajaxlogger/ajaxCallListener.js"></script>

<script type="text/javascript" charset="utf-8" src="plugins/ajaxlogger/ajaxCallLogger.js"></script>

<script type="text/javascript" charset="utf-8" src="plugins/state/statePlugin.js"></script>
<script type="text/javascript" charset="utf-8" src="plugins/broadcaster/broadcastEventListener.js"></script>


<script>

	var currentAssetId,
			currentFileId;


	//functions

	/**
	 * Change state to 'state'
	 * @param state
	 */
	function changeState(state) {
		statePlugin.changeState(state);
	}

	/**
	 * Show breadcrumb
	 */
	function showBreadcramb(breadcrumb) {
		$('#breadcrumbs #' + breadcrumb).removeClass('hidden').addClass('dark');

	}



	/**
	 * Show asset breadcrumb
	 */
	function showAssetBreadcrumb(assetId) {
		showBreadcramb('asset');
		$('#asset').find('.bread-crumb-inner').text('Asset ID: ' + assetId);

		//hide the create asset button
		$('#create-asset').hide();

		//show the create file button
		$('#create-file').show();
	}

	function showAssetFilesBreadcrumb(fileType){
		showBreadcramb('file-type');
		$('#file-type').find('.bread-crumb-inner').text(fileType);
	}

	/**
	 * Load show my assets files page
	 * Shows my assets file groups
	 */
	function showMyAssetFiles() {
		$('#mainIframe').attr('src', 'examples/drive/show-my-assets/files.html?assetId=' + currentAssetId);
		showAssetBreadcrumb(currentAssetId)

	}

	function openUploadFileMenu(elem){
		$(elem).next('i').click();
	}

	function goToUploadFilePage(page){
		var uploadPage = page === 'source' ? 'upload-source-file' : 'upload-thumbnail-file';

		uploadPage = 'examples/drive/' + uploadPage + '/?assetId=' + currentAssetId;

		$('#mainIframe').attr('src',uploadPage);
	}


	//run onload
	jQuery(document).ready(function ($) {
		ajaxCallLogger.createLoggerElement(".footer");
		ajaxCallLogger.startIframeListener();
		broadcastEventListener.startIframeBroadcastListener();

		if (spark.auth.isAccessTokenValid()) {
			statePlugin.changeState('myAssets');
		}
		else {
			statePlugin.changeState('login');
		}

		$(".menu-item").click(function (e) {
			e.preventDefault();
			var state = $(this).data("state");
			statePlugin.changeState(state);
			$(this).addClass("selected");
		});


		common.setUIFunctionality();

	});


	var states = {
		login: {
			src: 'plugins/login/login.html',
			enabledTabs: [],
			disabledTabs: ['#myAssetsId', '#createAssetId', '#manageFilesId'],
			callbackFunc: function () {
				$('#breadcrumbs-section').hide();
				$('.menu-item').removeClass('selected');
			}
		},

		myAssets: {
			src: 'examples/drive/show-my-assets/index.html',
			enabledTabs: ['#myAssetsId'],
			disabledTabs: ['#loginId', '#createAssetId', '#manageFilesId'],
			callbackFunc: function () {
				$('#breadcrumbs-section div#action-button div').hide();
				$('.menu-item').removeClass('selected');
				showBreadcramb('home');
			}
		},

		createAsset: {
			src: 'examples/drive/create-asset/index.html',
			enabledTabs: ['#myAssetsId', '#createAssetId'],
			disabledTabs: ['#loginId', '#manageFilesId'],
			callbackFunc: function () {
				$('#breadcrumbs-section div#action-button div').hide();
				$('.menu-item').removeClass('selected');
			}
		},

		manageFiles: {
			src: 'examples/drive/show-my-assets/files.html',
			enabledTabs: [],
			disabledTabs: [],
			callbackFunc: function () {
				$('#breadcrumbs-section div#action-button div').hide();
				$('.menu-item').removeClass('selected');
			}
		}
	};


	/**
	 * Events that are called from the iframe
	 * @type {{myAssetsEvent: Function, myAssetsFilesEvent: Function}}
	 */
	var broadCastsCallbacks = {

		myAssetsEvent: function () {
			$('#breadcrumbs-section div#action-button #create-asset').show();
		},

		myAssetsFilesEvent: function (optionalParams) {
			currentAssetId = optionalParams.assetId;
			showAssetBreadcrumb(currentAssetId);
		},
		createAssetEvent: function () {
			$('#breadcrumbs-section div#action-button #create-asset').show();
		},
		showAssetFilesEvent: function(optionalParams){
			showAssetFilesBreadcrumb(optionalParams.fileType);
		}
	}

	/**
	 * Map of all the possible broadcased events from the iframe
	 * @type {Array}
	 */
	var broadcastMapper = [];

	broadcastMapper['showMyAssets.index'] = broadCastsCallbacks.myAssetsEvent;
	broadcastMapper['showMyAssets.files'] = broadCastsCallbacks.myAssetsFilesEvent;
	broadcastMapper['createAsset'] = broadCastsCallbacks.createAssetEvent;
	broadcastMapper['showAssetFiles'] = broadCastsCallbacks.showAssetFilesEvent;



</script>


</body>
</html>
